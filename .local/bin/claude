#!/bin/bash
# Claude Code Container Wrapper - Clean Architecture
# Orchestrates container-based Claude Code execution with automatic configuration

set -e

# Load shared modules
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
LIB_DIR="$SCRIPT_DIR/../lib"

source "$LIB_DIR/env-loader.sh"
source "$LIB_DIR/path-resolver.sh"
source "$LIB_DIR/git-config.sh"
source "$LIB_DIR/watch-processes.sh"
source "$LIB_DIR/container-manager.sh"

# Load environment automatically
load_project_env

# Resolve project paths
resolve_paths

# Setup git configuration automatically
setup_host_git_config

# Start watch processes before container
start_watch_processes

# Start container if needed
start_container

# Execute Claude in container
exec_in_container "$@"